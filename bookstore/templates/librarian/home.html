{% extends 'librarian/base.html' %}
{% load static %}

{% block title %}Tableau de bord | BookApp{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- En-tête -->
  <div class="mb-8">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 flex items-center">
          <span class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-3 rounded-xl mr-4">
            <i class="fas fa-book-open"></i>
          </span>
          Tableau de bord
        </h1>
        <p class="mt-2 text-gray-500">Aperçu des activités de votre bibliothèque</p>
      </div>
      <div class="mt-4 md:mt-0">
        <div class="relative">
          <span class="absolute inset-y-0 left-0 flex items-center pl-3">
            <i class="fas fa-search text-gray-400"></i>
          </span>
          <input type="text" class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Rechercher...">
        </div>
      </div>
    </div>
  </div>

  <!-- Cartes de statistiques -->
  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
    <!-- Carte Livres -->
    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-md border border-blue-100 overflow-hidden transition-transform duration-300 hover:scale-[1.02]">
      <div class="p-6">
        <div class="flex justify-between">
          <div>
            <p class="text-sm font-semibold text-blue-600 uppercase tracking-wider">Livres</p>
            <p class="mt-2 text-3xl font-bold text-gray-900">{{ book }}</p>
            <p class="mt-1 text-sm text-blue-500">+5.2% ce mois</p>
          </div>
          <div class="h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-book text-blue-600 text-xl"></i>
          </div>
        </div>
      </div>
      <div class="px-6 py-3 bg-white bg-opacity-50">
        <a href="{% url 'lmbook' %}" class="text-sm font-medium text-blue-600 hover:text-blue-700 flex items-center justify-between">
          <span>Gérer les livres</span>
          <i class="fas fa-chevron-right ml-2"></i>
        </a>
      </div>
    </div>

    <!-- Carte Utilisateurs -->
    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl shadow-md border border-green-100 overflow-hidden transition-transform duration-300 hover:scale-[1.02]">
      <div class="p-6">
        <div class="flex justify-between">
          <div>
            <p class="text-sm font-semibold text-green-600 uppercase tracking-wider">Utilisateurs</p>
            <p class="mt-2 text-3xl font-bold text-gray-900">{{ user }}</p>
            <p class="mt-1 text-sm text-green-500">+12% ce mois</p>
          </div>
          <div class="h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-users text-green-600 text-xl"></i>
          </div>
        </div>
      </div>
      <div class="px-6 py-3 bg-white bg-opacity-50">
        <a href="#" class="text-sm font-medium text-green-600 hover:text-green-700 flex items-center justify-between">
          <span>Voir les utilisateurs</span>
          <i class="fas fa-chevron-right ml-2"></i>
        </a>
      </div>
    </div>

    <!-- Carte Exemplaires -->
    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-md border border-purple-100 overflow-hidden transition-transform duration-300 hover:scale-[1.02]">
      <div class="p-6">
        <div class="flex justify-between">
          <div>
            <p class="text-sm font-semibold text-purple-600 uppercase tracking-wider">Disponibles</p>
            <p class="mt-2 text-3xl font-bold text-gray-900">{{ available_copies }}</p>
            <p class="mt-1 text-sm text-purple-500">78% du stock</p>
          </div>
          <div class="h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-clone text-purple-600 text-xl"></i>
          </div>
        </div>
      </div>
      <div class="px-6 py-3 bg-white bg-opacity-50">
        <a href="#" class="text-sm font-medium text-purple-600 hover:text-purple-700 flex items-center justify-between">
          <span>Voir l'inventaire</span>
          <i class="fas fa-chevron-right ml-2"></i>
        </a>
      </div>
    </div>

    <!-- Carte Emprunts -->
    <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl shadow-md border border-amber-100 overflow-hidden transition-transform duration-300 hover:scale-[1.02]">
      <div class="p-6">
        <div class="flex justify-between">
          <div>
            <p class="text-sm font-semibold text-amber-600 uppercase tracking-wider">Emprunts</p>
            <p class="mt-2 text-3xl font-bold text-gray-900">{{ checked_out }}</p>
            <p class="mt-1 text-sm text-amber-500">3 en retard</p>
          </div>
          <div class="h-12 w-12 bg-amber-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-exchange-alt text-amber-600 text-xl"></i>
          </div>
        </div>
      </div>
      <div class="px-6 py-3 bg-white bg-opacity-50">
        <a href="#" class="text-sm font-medium text-amber-600 hover:text-amber-700 flex items-center justify-between">
          <span>Gérer les prêts</span>
          <i class="fas fa-chevron-right ml-2"></i>
        </a>
      </div>
    </div>
  </div>

  <!-- Graphique et Activités -->
  <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Graphique -->
    <div class="bg-white rounded-2xl shadow-md border border-gray-100 p-6 lg:col-span-2">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-lg font-semibold text-gray-900">Activité mensuelle</h2>
        <select class="text-sm border border-gray-300 rounded-lg px-3 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <option>Ce mois</option>
          <option>30 derniers jours</option>
          <option>Cette année</option>
        </select>
      </div>
      <div class="h-64 bg-gray-50 rounded-xl flex items-center justify-center">
        <div class="text-center">
          <i class="fas fa-chart-bar text-4xl text-gray-300 mb-3"></i>
          <p class="text-gray-500">Graphique d'activité</p>
          <p class="text-sm text-gray-400 mt-1">Les données apparaîtront ici</p>
        </div>
      </div>
    </div>

    <!-- Dernières activités -->
    <div class="bg-white rounded-2xl shadow-md border border-gray-100 p-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-lg font-semibold text-gray-900">Dernières activités</h2>
        <button class="text-gray-400 hover:text-gray-500">
          <i class="fas fa-ellipsis-v"></i>
        </button>
      </div>
      <div class="space-y-4">
        <div class="flex items-start">
          <div class="flex-shrink-0 h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-book text-blue-600"></i>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-900">Nouveau livre ajouté</p>
            <p class="text-sm text-gray-500">"Le Petit Prince" par Antoine de Saint-Exupéry</p>
            <p class="text-xs text-gray-400 mt-1">Il y a 2 heures</p>
          </div>
        </div>
        <div class="flex items-start">
          <div class="flex-shrink-0 h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-user text-green-600"></i>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-900">Nouvel utilisateur</p>
            <p class="text-sm text-gray-500">Marie Dupont s'est inscrite</p>
            <p class="text-xs text-gray-400 mt-1">Aujourd'hui, 09:45</p>
          </div>
        </div>
        <div class="flex items-start">
          <div class="flex-shrink-0 h-10 w-10 bg-amber-100 rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-exchange-alt text-amber-600"></i>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-900">Emprunt confirmé</p>
            <p class="text-sm text-gray-500">"1984" emprunté par Jean Martin</p>
            <p class="text-xs text-gray-400 mt-1">Hier, 16:30</p>
          </div>
        </div>
      </div>
      <div class="mt-6 text-center">
        <a href="#" class="text-sm font-medium text-primary hover:text-primary-dark inline-flex items-center">
          Voir toutes les activités
          <i class="fas fa-arrow-right ml-2"></i>
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block javascripts %}
{{ block.super }}
<script>
  // Animation des cartes au chargement
  document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.grid > div');
    cards.forEach((card, index) => {
      setTimeout(() => {
        card.classList.add('opacity-100', 'translate-y-0');
      }, index * 100);
    });
  });

  // Rafraîchissement automatique
  const refreshData = () => {
    fetch('?partial=true')
      .then(response => response.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Mettre à jour les compteurs
        document.querySelectorAll('[data-counter]').forEach(el => {
          const newValue = doc.querySelector(`[data-counter="${el.dataset.counter}"]`);
          if (newValue) {
            animateCounter(el, newValue.textContent);
          }
        });
      });
  };

  // Animation des compteurs
  const animateCounter = (element, target) => {
    const duration = 1000;
    const start = parseInt(element.textContent);
    const increment = (target - start) / duration * 16;
    
    let current = start;
    const timer = setInterval(() => {
      current += increment;
      if ((increment > 0 && current >= target) || (increment < 0 && current <= target)) {
        clearInterval(timer);
        current = target;
      }
      element.textContent = Math.floor(current);
    }, 16);
  };

  // Rafraîchir toutes les minutes
  setInterval(refreshData, 60000);
</script>
{% endblock %}